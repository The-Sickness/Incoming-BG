name: Package AddOn

on:
  push:
    branches:
      - main  # Ensure this matches the branch name you use

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Cache Lua
      uses: actions/cache@v2
      with:
        path: |
          /opt/lua/
        key: ${{ runner.os }}-lua

    - name: Cache LuaRocks
      uses: actions/cache@v2
      with:
        path: |
          /opt/luarocks/
        key: ${{ runner.os }}-luarocks

    - name: Setup Lua
      uses: leafo/gh-actions-lua@v1

    - name: Setup LuaRocks
      uses: leafo/gh-actions-luarocks@v1

    - name: Install Packager
      run: |
        wget -O release.sh https://raw.githubusercontent.com/BigWigsMods/packager/master/release.sh
        chmod +x release.sh

    - name: Package AddOn
      run: ./release.sh -d -z

    - name: Upload Artifacts
      uses: actions/upload-artifact@v2
      with:
        name: packaged-addon
        path: ./releases
